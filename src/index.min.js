import{html,LitElement}from"lit-element";import style from"./scss/style.scss";import jQuery from"./vendors/jquery.min.js";import Hammer from"hammerjs";import propagating from"propagating-hammerjs";import panzoom from"panzoom";import QRCode from"davidshimjs-qrcodejs";import config from"./config";const detect=require("detect-browser")["detect"],browser=detect();class MapView extends LitElement{constructor(){super();const e=window.navigator.userLanguage||window.navigator.language;this.language=e.split("-")[0]}static get properties(){return{language:{type:String},totem:{type:String},fullview:{type:String},hidezoom:{type:String}}}render(){return html`
			<div class="outer-map-container">
			<div class="inner-map-component" class="axonometric" data-building='axonometric'>
				<style>
					${getStyle(style)}
				</style>
				<div class="header">
					<div class="aux">
						<div class="navbar-container">
							<p class="site-title clickable" data-building-code="axonometric">NOI Techpark Maps</p>
							<nav class="dropdown building-select hide">
								<span class="dropdown-trigger hide"></span>
								<ul class="dropdown-list hide"></ul>
							</nav>
						</div>
						<span class="search-trigger icon-search translatable">Ricerca</span>
						<span class="option-trigger icon-option"><span class="icon translatable">Filtri</span></span>
						<div class="search-container" style="">
							<div class="input-container">
								<input type="text" placeholder="Ricerca (minimo 3 caratteri)" class="search translatable" />
							</div>
							<div class="category-group-container">
								<div class="no-results-container"><p>No results</p></div>
								<div class="category-group original" style="display:none;">
									<div class="group-title-container dropdown-trigger">
								        <h2></h2>
								    </div>
								    <ul class="group-rooms-list dropdown-list" style="/*display:block;*/">
								    </ul>
								</div>
							</div>
						</div>
						<div class="option-filter-container">
							<div class="title-container">
								<span class="option-close icon-close"><span class="icon translatable">Chiudi</span></span>
								<h2 class="translatable">Chiudi i filtri</h2>
							</div>
							<div class="filter-container-container">
								<div class="filter-container">
									<p class="accent-color translatable">Visibilit√† elementi in planimetria</p>
									<ul class="filters">
										<li class="single-filter">
											<input class="all-filters-checkbox" type="checkbox" id="all-1" checked="checked">
											<label for="all-1" class="translatable">Attiva tutte le opzioni</label>
										</li>
										<li class="single-filter original">
											<input type="checkbox" id="" checked="checked" data-category="" class="filter-trigger" />
											<label for=""></label>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="mapContainer">
					<div class="loader loader-map">
						<svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg" stroke="#010101"> <g fill="none" fill-rule="evenodd" stroke-width="2"> <circle cx="22" cy="22" r="1"> <animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite" /> <animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite" /> </circle> <circle cx="22" cy="22" r="1"> <animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite" /> <animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite" /> </circle> </g></svg>
					</div>
					<div class="tooltip">
						<div class="pin">PIN</div>
						<div class="card">
							<div class="heading">
								<span class="icon hide"></span>
								<div class="name-short-description-container">
									<p class="name hide"></p>
									<p class="short-description hide"></p>
								</div>
							</div>
							<div class="long-description"></div>
							<div class="lower hide">
								<p class="expand-info hide translatable">Info</p>
								<p class="view-floorplan hide translatable">Vedi planimetria</p>
								<a class="website hide" target="_blank">Website</a>
								<p class="share-element hide translatable">Share</p>
							</div>
							<div id="room-qrcode"></div>
						</div>
					</div>
					<div class="floors-zoom-selector">
						<div class="floors-selector hide">
							<span class="icon-building icon-building-A1">A1</span>
							<ul class="floors-list">
							</ul>
						</div>
						<div class="zoom-selector">
							<span class="plus">+</span>
							<span class="minus">_</span>
						</div>
					</div>
					<div id="map">
					</div>
				</div>
				<span class="js-media-query-tester"></span>
				<div class="sharer-container hide">
					<div class="sharer">
						<input type="text" id="sharer-url-input" readonly />
						<span id="copy-sharer-url" class="translatable">Copia link</span>
					</div>
				</div>
			</div>
			</div>
		`}firstUpdated(){shadowRoot=this.shadowRoot;var e=this.language,o=Number.parseInt(this.totem),t=Number.parseInt(this.fullview),r=Number.parseInt(this.hidezoom);documentReadyNOIMaps(shadowRoot,e,o,t,r)}}function getStyle(e){return e[0][1]}var ODHdata="",controller="",shadowRoot="",thisQrcode=null,buildings_summary=[],clickedElementID="",thisNoiMapsSettingsLang="it",thisNoiMapsSettingsTotem=!1,thisNoiMapsSettingsFullview=!1,thisNoiMapsSettingsHideZoom=!1,originalTooltip="",maps_svgs=[],NOIrooms=[],selettoriType=[],translations=[],minCharsToSearch=3,getParams=new URLSearchParams(window.location.search),debugActive=getParams.get("debug");function resizeEndActionsNOIMaps(){if(sidebarHeightNOIMaps(),setMediaQueriesNOIMaps(),setTooltipPositionNOIMaps(),tooltipViewportNOIMaps(),"object"==typeof controller&&null!==controller&&void 0!==controller.moveBy)try{controller.moveBy(.001,.001)}catch(e){}}function cleanupRoomLabelNOIMaps(o){if(void 0===o)return!1;{let e=o.replace(/\-/g,"--");return e.replace(/[ \.]/g,"-")}}function documentReadyNOIMaps(r,a,e,o,t){shadowRoot=r,setMediaQueriesNOIMaps(),browser&&jQuery(shadowRoot.querySelectorAll(".inner-map-component")).addClass("browser-"+browser.name);var l=new URL(window.location.href),s=l.searchParams.get("shared"),n=l.searchParams.get("lang"),d=l.searchParams.get("totem"),c=l.searchParams.get("fullview"),l=l.searchParams.get("hidezoom");(null!=a||0<=jQuery.inArray(a,["it","en","de"]))&&(thisNoiMapsSettingsLang=a),void 0!==n&&null!=n&&0<=jQuery.inArray(a,["it","en","de"])&&(thisNoiMapsSettingsLang=n),null==e||isNaN(e)||(thisNoiMapsSettingsTotem=0<e),null==d||isNaN(d)||(thisNoiMapsSettingsTotem=0<d),null==t||isNaN(t)||(thisNoiMapsSettingsHideZoom=0<t),null==l||isNaN(l)||(thisNoiMapsSettingsHideZoom=0<l),null==t||isNaN(t)||(thisNoiMapsSettingsHideZoom=0<t),null==l||isNaN(l)||(thisNoiMapsSettingsHideZoom=0<l),null==c||isNaN(c)||(thisNoiMapsSettingsFullview=0<c),thisNoiMapsSettingsTotem&&jQuery(shadowRoot.querySelectorAll(".outer-map-container")).addClass("totem"),thisNoiMapsSettingsFullview&&(jQuery("map-view").attr("fullview","1"),jQuery("body").addClass("fullview")),thisNoiMapsSettingsHideZoom&&jQuery(shadowRoot.querySelectorAll(".floors-zoom-selector .zoom-selector")).hide(),jQuery.getJSON(config.OPEN_DATA_HUB_ONLY_SHOW_MAP,function(e){for(var o in(ODHdata=e).data){var t=ODHdata.data[o].smetadata.beacon_id;void 0!==t&&(t=cleanupRoomLabelNOIMaps(t),NOIrooms[t]=ODHdata.data[o].smetadata)}0<Object.keys(ODHdata).length&&(writeGroupsSidebarNOIMaps(ODHdata),jQuery.getJSON(config.OPEN_DATA_HUB_BUILDINGS,function(e){for(var o in printMapNOIMaps("axonometric"),e.data)buildings_summary[e.data[o].smetadata.building_code]=e.data[o].smetadata;if("undefined"!=typeof roomLabel){let e=e.replace(/[ \.]/g,"-");NOIrooms[e]=ODHdata.data[i].smetadata}0<Object.keys(NOIrooms).length&&setTimeout(function(){if(jQuery(shadowRoot.querySelectorAll(".loader")).fadeOut(),getTranslationsNOIMaps(),dropdownToggleNOIMaps(),jQuery(shadowRoot.querySelectorAll(".loader-map")).addClass("map-loaded"),void 0!==s&&null!=s&&""!=s){let t=s.toUpperCase();if(t in NOIrooms){let o=t.split("-")[0];var r=setInterval(function(){clickedElementNOIMaps(t);let e=jQuery(shadowRoot.querySelectorAll(".inner-map-component"));e.data("building")!=o&&e.data("floor")!=NOIrooms[t].floor||clearInterval(r)},500)}else console.log("ERROR: Element with code '"+t+"' not found.")}},500)}).fail(function(e,o,t){console.log("Error on documentReadyNOIMaps (ajax fail)"),console.log("305 error "+o+":::"+t),console.log("incoming Text "+e.responseText),setTimeout(function(){documentReadyNOIMaps(r,a)})}).always(function(){setupMapBehavioursNOIMaps()}))}).fail(function(e,o){1==debugActive&&(console.log("Error on documentReadyNOIMaps (ajax fail)"),console.log("error "+o),console.log("incoming Text "+e.responseText)),console.log("306 error "+o),console.log("incoming Text "+e.responseText)}).always(function(){clickableBehaviourNOIMaps()}),originalTooltip=jQuery(shadowRoot.querySelectorAll(".tooltip")).html(),jQuery(shadowRoot.querySelectorAll(".option-trigger")).on("click",function(){jQuery(shadowRoot.querySelectorAll(".outer-map-container")).addClass("option-open")}),jQuery(shadowRoot.querySelectorAll(".option-close")).on("click",function(){jQuery(shadowRoot.querySelectorAll(".outer-map-container")).removeClass("option-open")}),jQuery(shadowRoot.querySelectorAll(".search-trigger")).on("click",function(){jQuery(shadowRoot.querySelectorAll(".outer-map-container")).toggleClass("search-open"),jQuery(shadowRoot.querySelectorAll(".outer-map-container")).hasClass("search-open")&&jQuery(shadowRoot.querySelectorAll("input.search")).focus(),setTimeout(function(){setTooltipPositionNOIMaps()},300)}),dropdownToggleNOIMaps(),dropdownSelectionNOIMaps(),sharerBehavioursNOIMaps(),roomQRCodeNOIMaps(),sidebarHeightNOIMaps(),jQuery(window).resize(function(){clearTimeout(window.resizedFinishedNOIMaps),window.resizedFinishedNOIMaps=setTimeout(function(){resizeEndActionsNOIMaps()},250)})}function getTranslationsNOIMaps(){jQuery.getJSON(config.OPEN_DATA_HUB_TRANSLATIONS,function(e){e=e.data.filter(function(e){return"Traduzioni"==e.mvalue});void 0!==e[0]&&null!=e[0]&&(translations=e[0].tmetadata),0<Object.keys(translations).length?(clickableBehaviourNOIMaps(),getSelettoriTypeNOIMaps(),searchElementsStarterNOIMaps(),translateElementsNOIMaps()):(1==debugActive&&console.log("Error on getTranslationsNOIMaps fetching translations"),console.log("400 error: reload "))}).fail(function(e,o,t){1==debugActive&&(console.log("Error on getTranslationsNOIMaps (ajax fail)"),console.log("error "+o+":::"+t),console.log("incoming Text "+e.responseText))})}function translateElementsNOIMaps(){jQuery(shadowRoot.querySelectorAll(".translatable")).each(function(){jQuery(this).is("input")?jQuery(this).attr("placeholder",getTranslationNOIMaps(jQuery(this).attr("placeholder"))):jQuery(this).text(getTranslationNOIMaps(jQuery(this).text()))})}function getBuildingDataNOIMaps(e,o){if("undefined"==typeof buildings||void 0===buildings.data||void 0===e||void 0===o||""==o||null==o)return!1;for(var t in buildings.data)if(void 0!==buildings.data[t].smetadata.building_code&&buildings.data[t].smetadata.building_code==e&&void 0!==buildings.data[t].smetadata[o])return buildings.data[t].smetadata[o];return!1}function printMapNOIMaps(e){0===Object.keys(maps_svgs).length&&fetchMapsSVGNOIMaps(e)}function replaceImageUrl(e){return e.replace("https://images.maps.noi.opendatahub.bz.it",config.OPEN_DATA_HUB_RESOURCE_URL)}function fetchMapsSVGNOIMaps(a){jQuery.getJSON(config.OPEN_DATA_HUB_FLOORS,function(e){for(var o in e.data){let t=e.data[o].smetadata.building_code;maps_svgs[t]=[],maps_svgs[t].floors={};let r=e.data[o].smetadata.floor;void 0!==e.data[o].smetadata.building_code&&void 0!==e.data[o].smetadata.image&&(o=replaceImageUrl(e.data[o].smetadata.image),jQuery.get(o,e=>{let o=jQuery(e).find("svg");o=o.removeAttr("xmlns:a"),!o.attr("viewBox")&&o.attr("height")&&o.attr("width")&&o.attr(`viewBox 0 0  ${o.attr("height")} `+o.attr("width")),maps_svgs[t].floors[r]=o.prop("outerHTML"),void 0!==a&&void 0!==t&&t==a&&(jQuery(shadowRoot.getElementById("map")).html(o.prop("outerHTML")),setTimeout(function(){clickableBehaviourNOIMaps()},50))},"xml"))}})}function writeGroupsSidebarNOIMaps(h){jQuery.getJSON(config.OPEN_DATA_HUB_TYPES_GROUPS,function(e){let o=e.data.filter(function(e){return"Selettori Group"==e.mvalue});void 0!==o[0]&&void 0!==o[0].tmetadata||(1==debugActive&&console.log("Error on writeGroupsSidebarNOIMaps"),console.log("490 object undefined xxx1")),o=o[0].tmetadata;let t=jQuery(shadowRoot.querySelectorAll(".search-container .category-group")).clone();t.removeClass("original");var r,a,i=[];for(r in o){var l=o[r].order,s=o[r];s.name=r,i[l]=s}for(a in i){let o=t.clone().removeAttr("style"),e="";for(var n in void 0!==i[a].image&&(e='<img src="'+replaceImageUrl(i[a].image)+'" />'),o.find(".group-title-container").prepend(e),o.find("h2").text(i[a].name),h.data)if(h.data[n].smetadata.group==i[a].name){let e=cleanupRoomLabelNOIMaps(h.data[n].smetadata.beacon_id);var d,c=e.split("-"),u=void 0!==h.data[n].smetadata.name&&void 0!==h.data[n].smetadata.name[thisNoiMapsSettingsLang]?h.data[n].smetadata.name[thisNoiMapsSettingsLang]:"",p=h.data[n].smetadata.beacon_id.replace(/\-/g,"~-");p=(p=(p=(p=p.replace(/\s/g,"~")).replace(/\./g,"~")).replace(/~~/g,"~")).split("~");for(var g=0;g<p.length;g++)d=3<p.length?p[p.length-2]+"-"+p[p.length-1]:p[p.length-1];o.find(".group-rooms-list").append('<li class="clickable" data-building-code="'+c[0]+'" data-room-code="'+e+'" data-floor-code="'+h.data[n].smetadata.floor+'"><span class="room-icon-building icon-building-'+c[0]+'">'+c[0]+'</span><span class="room-name">'+u+'</span><span class="room-floor">'+h.data[n].smetadata.floor+'</span><span class="room-number">'+d+"</span></li>")}jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container")).append(o)}}).fail(function(e,o){1==debugActive&&(console.log("Error on writeGroupsSidebarNOIMaps (ajax fail)"),console.log("error "+o),console.log("incoming Text "+e.responseText)),console.log("551 error "+o),console.log("incoming Text "+e.responseText)})}function filtersBehavioursNOIMaps(){for(var o in selettoriType)if(void 0!==selettoriType[o].name&&null!==selettoriType[o].name&&void 0!==selettoriType[o].name[thisNoiMapsSettingsLang]&&null!==selettoriType[o].name[thisNoiMapsSettingsLang]){let e=jQuery(shadowRoot.querySelectorAll(".filter-container .filters .single-filter.original")).clone();e.removeClass("original"),e.find("label").text(selettoriType[o].name[thisNoiMapsSettingsLang]),e.find("label").attr("for","filter-"+o),e.find("input").attr("id","filter-"+o),e.find("input").attr("data-category",o),jQuery(shadowRoot.querySelectorAll(".filter-container .filters")).append(e)}jQuery(shadowRoot.querySelectorAll(".all-filters-checkbox")).click(function(){jQuery(this).is(":checked")?jQuery(shadowRoot.querySelectorAll(".filter-container .single-filter .filter-trigger")).prop("checked",!0):jQuery(shadowRoot.querySelectorAll(".filter-container .single-filter .filter-trigger")).prop("checked",!1),jQuery(shadowRoot.querySelectorAll(".filter-container .single-filter .filter-trigger")).trigger("change")}),jQuery(shadowRoot.querySelectorAll(".filters .single-filter .filter-trigger")).change(function(){let e=jQuery(this);void 0!==e.data("category")&&0<e.data("category").length&&(e.is(":checked")?jQuery(shadowRoot.querySelectorAll('g[data-category="'+e.data("category")+'"] image')).fadeIn("fast"):jQuery(shadowRoot.querySelectorAll('g[data-category="'+e.data("category")+'"] image')).fadeOut("fast"))})}function getSelettoriTypeNOIMaps(){jQuery.getJSON(config.OPEN_DATA_HUB_TYPES,function(e){e=e.data.filter(function(e){return"Selettori Type"==e.mvalue});void 0!==e[0]&&null!=e[0]&&(selettoriType=e[0].tmetadata),(0<Object.keys(selettoriType).length?filtersBehavioursNOIMaps:getSelettoriTypeNOIMaps)()})}function setupMapBehavioursNOIMaps(){(controller=panzoom(shadowRoot.getElementById("map"),{zoomDoubleClickSpeed:1,zoomSpeed:.04,maxZoom:10,minZoom:1,smoothScroll:!0,bounds:!0,boundsPadding:1,boundsDisabledForZoom:!0})).on("transform",function(){setTooltipPositionNOIMaps()}),setMapZoomNOIMaps(),jQuery(shadowRoot.querySelectorAll("#mapContainer")).unbind();var e=propagating(new Hammer(jQuery(shadowRoot.querySelectorAll("#mapContainer"))[0],{}));e.off("tap"),e.on("pan",function(e){0!==jQuery(e.firstTarget).parents(".floors-list").length&&controller.pause()}),e.on("tap",function(e){e.stopPropagation(),0==jQuery(e.firstTarget).parents(".tooltip.active").length&&jQuery(shadowRoot.querySelectorAll("#map .clickable")).each(function(){var e=jQuery(this),o=e.attr("class");-1!=o.indexOf("active")&&(o=(o=o.replace(" active","")).replace("active",""),e.attr("class",o))}),void 0!==e&&void 0!==e.firstTarget&&(0!=jQuery(e.firstTarget).parents(".tooltip").length||jQuery(e.firstTarget).hasClass("clickable")||0!=jQuery(e.firstTarget).parents(".clickable").length||closeTooltipNOIMaps(e),jQuery(e.firstTarget).hasClass("share-element")&&(jQuery(shadowRoot.querySelectorAll(".sharer-container")).removeClass("hide").fadeIn(),jQuery(shadowRoot.querySelectorAll(".sharer-container")).find("input").val(location.origin+location.pathname+"?shared="+jQuery(shadowRoot.querySelectorAll(".share-element")).attr("data-element-code")+"&lang="+thisNoiMapsSettingsLang),jQuery(shadowRoot.querySelectorAll(".sharer-container")).find("input").select())),jQuery(e.firstTarget).hasClass("view-floorplan")&&void 0!==jQuery(e.firstTarget).data("building-code")&&null!==jQuery(e.firstTarget).data("building-code")&&""!==jQuery(e.firstTarget).data("building-code")&&void 0!==jQuery(e.firstTarget).data("building-floor")&&null!==jQuery(e.firstTarget).data("building-floor")&&""!==jQuery(e.firstTarget).data("building-floor")&&goToBuildingFloorNOIMaps(jQuery(e.firstTarget).data("building-code"),jQuery(e.firstTarget).data("building-floor"),!0),setTimeout(function(){controller.pause(),setTimeout(function(){controller.resume()},100)},100)}),jQuery(shadowRoot.querySelectorAll(".navbar-container .site-title")).click(function(e){e.preventDefault(),goToBuildingFloorNOIMaps("axonometric","0",!0)});e=new Hammer(shadowRoot.querySelectorAll(".floors-zoom-selector .zoom-selector .plus")[0],{});e.off("tap"),e.on("tap",function(){controller.smoothZoom(jQuery(shadowRoot.getElementById("map")).outerWidth()/2,jQuery(shadowRoot.getElementById("map")).outerHeight()/2,1.5)});e=new Hammer(shadowRoot.querySelectorAll(".floors-zoom-selector .zoom-selector .minus")[0],{});e.off("tap"),e.on("tap",function(){controller.smoothZoom(jQuery(shadowRoot.getElementById("map")).outerWidth()/2,jQuery(shadowRoot.getElementById("map")).outerHeight()/2,.5)}),clickableBehaviourNOIMaps(),jQuery(shadowRoot.querySelectorAll(".floors-list")).on("click",".floor",function(){goToBuildingFloorNOIMaps(jQuery(this).data("building-code"),jQuery(this).data("floor-code"),!0)}),jQuery(shadowRoot.querySelectorAll(".dropdown.building-select")).on("click",".building-select-trigger",function(e){return e.preventDefault(),goToBuildingFloorNOIMaps(jQuery(this).data("building-code"),"0",!0),!1})}function setMapZoomNOIMaps(){void 0!==controller&&(controller.zoomAbs(0,0,1),controller.moveBy(.001,.001),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).hasClass("dim_40")||setTimeout(function(){jQuery(shadowRoot.querySelectorAll(".tooltip")).hasClass("active")&&void 0!==clickedElementID&&0<jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).length?setTimeout(function(){var e=jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).offset().left,o=jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).offset().top;isNaN(e)||isNaN(o)||(e>jQuery("#map").innerWidth()/2?controller.smoothZoom(e+jQuery(shadowRoot.getElementById("#mapContainer")).innerWidth()/3,o,3):controller.smoothZoom(e+jQuery(shadowRoot.getElementById("#mapContainer")).innerWidth()/16,o,3))},500):0<jQuery(shadowRoot.querySelectorAll("#map #main-entrance")).length?isNaN(jQuery(shadowRoot.querySelectorAll("#map #main-entrance")).offset().left)||isNaN(jQuery(shadowRoot.querySelectorAll("#map #main-entrance"))[0].getBoundingClientRect().width/2)||isNaN(jQuery(shadowRoot.querySelectorAll("#map #main-entrance")).offset().top)||controller.smoothZoom(jQuery(shadowRoot.querySelectorAll("#map #main-entrance")).offset().left+jQuery(shadowRoot.querySelectorAll("#map #main-entrance"))[0].getBoundingClientRect().width/2,jQuery(shadowRoot.querySelectorAll("#map #main-entrance")).offset().top,3):isNaN(jQuery(shadowRoot.getElementById("#map")).outerWidth()/2)||isNaN(jQuery(shadowRoot.getElementById("#map")).outerHeight()/2)||(jQuery(shadowRoot.querySelectorAll(".inner-map-component")).hasClass("axonometric")?controller.smoothZoom(jQuery(shadowRoot.getElementById("#map")).outerWidth()/2,jQuery(shadowRoot.getElementById("#map")).outerHeight()/2,2):controller.smoothZoom(jQuery(shadowRoot.getElementById("#map")).outerWidth()/2,jQuery(shadowRoot.getElementById("#map")).outerHeight()/2,3))},250))}function clickableBehaviourNOIMaps(){jQuery(shadowRoot.querySelectorAll(".clickable a")).unbind(),jQuery(shadowRoot.querySelectorAll(".clickable")).unbind(),jQuery(shadowRoot.querySelectorAll(".clickable")).click(function(e){return e.preventDefault(),!1}),jQuery(shadowRoot.querySelectorAll(".clickable a")).click(function(e){return e.preventDefault(),!1}),jQuery(shadowRoot.querySelectorAll(".clickable")).each(function(){var a=this;if(void 0!==jQuery(this).data("clickable"))return!0;jQuery(this).data("clickable","true");var e=propagating(new Hammer(a,{preventDefault:!0}));e.off("tap"),setTimeout(function(){e.on("tap",function(e){void 0!==controller&&setTimeout(function(){controller.pause(),setTimeout(function(){controller.resume()},50)},50),e.stopPropagation();var o=jQuery(a).data("building-code"),t=jQuery(a).data("room-code"),r=jQuery(a).data("floor-code");jQuery(shadowRoot.querySelectorAll(".clickable")).not(".floor").removeClass("active"),0<jQuery(a).parents(".building-select").length&&(jQuery(a).parents(".building-select").removeClass("open"),jQuery(a).parents(".building-select").find(".dropdown-list").slideToggle("fast")),void 0!==o&&""!=o&&(void 0!==r&&""!=r||0===r)&&void 0!==t&&""!=t?(setMapZoomNOIMaps(),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).hasClass("dim_40")||jQuery(shadowRoot.querySelectorAll(".outer-map-container")).removeClass("search-open"),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building")==o&&jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-floor")==r||goToBuildingFloorNOIMaps(o,r,!1),clickedElementNOIMaps(t,"room")):void 0!==o&&""!=o&&void 0===r?"axonometric"==jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building")?(e=void 0!==jQuery(a).data("building-code")&&null!==jQuery(a).data("building-code")&&""!==jQuery(a).data("building-code")&&jQuery(a).data("building-code"),t=void 0!==jQuery(a).data("building-floor")&&null!==jQuery(a).data("building-floor")&&""!==jQuery(a).data("building-floor")&&jQuery(a).data("building-floor"),e&&t?goToBuildingFloorNOIMaps(e,t,!0):clickedElementNOIMaps(o,"building")):goToBuildingFloorNOIMaps(o,"0",!0):void 0===o||""==o||void 0===r&&0!==r?clickedElementNOIMaps(jQuery(a).attr("id"),"room"):jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building")==o&&jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-floor")==r||goToBuildingFloorNOIMaps(o,r)})},50)})}function clickedElementNOIMaps(t,e="room"){if(0===Object.keys(NOIrooms).length)alert("NOIrooms empty - ERROR!");else if(void 0!==t&&null!=t&&void 0!==e&&null!=e){var r="",a="",i="",l="";let o=!1;if("building"==e&&void 0!==buildings_summary[t]&&(void 0!==buildings_summary[t].building_code&&""!=buildings_summary[t].building_code&&(r="icon-building-"+buildings_summary[t].building_code,clickedElementID="building_"+buildings_summary[t].building_code,-1==(d=jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).attr("class")).indexOf("active")&&(d+=" active",jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).attr("class",d))),void 0!==buildings_summary[t].building_name&&void 0!==buildings_summary[t].building_name[thisNoiMapsSettingsLang]&&""!==buildings_summary[t].building_name[thisNoiMapsSettingsLang]&&(a=buildings_summary[t].building_name[thisNoiMapsSettingsLang]),void 0!==buildings_summary[t].building_short_description&&void 0!==buildings_summary[t].building_short_description[thisNoiMapsSettingsLang]&&""!==buildings_summary[t].building_short_description[thisNoiMapsSettingsLang]&&(i=buildings_summary[t].building_short_description[thisNoiMapsSettingsLang]),void 0!==buildings_summary[t].building_description&&void 0!==buildings_summary[t].building_description[thisNoiMapsSettingsLang]&&""!==buildings_summary[t].building_description[thisNoiMapsSettingsLang]&&(l=buildings_summary[t].building_description[thisNoiMapsSettingsLang])),"room"==e){if(debugActive&&alert(t),debugActive&&alert(t),null!=NOIrooms&&""!==NOIrooms&&void 0!==NOIrooms[t]){void 0!==NOIrooms[t]&&null!=NOIrooms[t]&&void 0!==NOIrooms[t].type&&null!=NOIrooms[t].type&&void 0!==selettoriType[NOIrooms[t].type]&&null!==selettoriType[NOIrooms[t].type]&&void 0!==selettoriType[NOIrooms[t].type].image&&null!==selettoriType[NOIrooms[t].type].image&&(r=replaceImageUrl(selettoriType[NOIrooms[t].type].image));var a=void 0!==NOIrooms[t].name&&void 0!==NOIrooms[t].name[thisNoiMapsSettingsLang.toLowerCase()]?NOIrooms[t].name[thisNoiMapsSettingsLang.toLowerCase()]:NOIrooms[t].beacon_id,l=void 0!==NOIrooms[t].description&&void 0!==NOIrooms[t].description[thisNoiMapsSettingsLang.toLowerCase()]?NOIrooms[t].description[thisNoiMapsSettingsLang.toLowerCase()]:"",s=t.split("-")[0];i+='<span class="room-icon-building icon-building-'+s+'">'+s+"</span>";var n=void 0!==NOIrooms[t].floor&&!isNaN(NOIrooms[t].floor)&&NOIrooms[t].floor;isNaN(n)||(i+='<span class="room-floor">'+n+"</span>");var d=t.split("-");let e=d[d.length-1];isNaN(e)&&(e=d[d.length-2]+"-"+d[d.length-1]),i+='<span class="room-number">'+e+"</span>",o=void 0!==NOIrooms[t].link&&""!==NOIrooms[t].link&&NOIrooms[t].link,""===s||""===n||jQuery(shadowRoot.querySelectorAll(".inner-map-component")).data("building")===s&&jQuery(shadowRoot.querySelectorAll(".inner-map-component")).data("floor")===n||goToBuildingFloorNOIMaps(s,n,!1)}if(clickedElementID=t,0==jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).length)return closeTooltipNOIMaps(),!0}if(jQuery(shadowRoot.querySelectorAll(".tooltip .icon, .tooltip .name, .tooltip .short-description, .tooltip .lower, .tooltip .view-floorplan, .tooltip .website, .tooltip .share-element, .tooltip .expand-info")).addClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip")).removeClass("without-lower"),""==r&&""==a&&""==i&&""==l)return closeTooltipNOIMaps(),!0;""!=r?(jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).removeClass().addClass("icon"),"building"==e?(jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).addClass(r),jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).text(t)):(jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).addClass("icon-room"),jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).html("<img src='"+r+"' />"))):(jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).removeClass().addClass("icon").html(""),"undefined"!=typeof building&&null!==building&&(jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).addClass("building-"+building),jQuery(shadowRoot.querySelectorAll(".tooltip .icon")).text(building))),""!=a&&(jQuery(shadowRoot.querySelectorAll(".tooltip .name")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip .name")).text(a)),""!=i&&(jQuery(shadowRoot.querySelectorAll(".tooltip .short-description")).removeClass("hide"),"building"==e?jQuery(shadowRoot.querySelectorAll(".tooltip .short-description")).text(i):jQuery(shadowRoot.querySelectorAll(".tooltip .short-description")).html(i)),""!=l?jQuery(shadowRoot.querySelectorAll(".tooltip .long-description")).text(l):jQuery(shadowRoot.querySelectorAll(".tooltip .long-description")).text(""),"building"==e&&(jQuery(shadowRoot.querySelectorAll(".tooltip .lower")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip .lower .view-floorplan")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip .lower .view-floorplan")).attr("data-building-code",t),l=0,"undefined"===jQuery(shadowRoot.querySelectorAll("#building_"+t)).data("building-floor")||isNaN(jQuery(shadowRoot.querySelectorAll("#building_"+t)).data("building-floor"))||(l=jQuery(shadowRoot.querySelectorAll("#building_"+t)).data("building-floor")),jQuery(shadowRoot.querySelectorAll(".tooltip .lower .view-floorplan")).attr("data-building-floor",l),void 0===maps_svgs[t]&&(jQuery(shadowRoot.querySelectorAll(".tooltip .lower")).addClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip")).addClass("without-lower"))),"room"==e&&(jQuery(shadowRoot.querySelectorAll(".tooltip .lower")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip .lower .share-element")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip .lower .share-element")).attr("data-element-code",t),jQuery(shadowRoot.querySelectorAll(".tooltip .room-url")).text(location.origin+location.pathname+"?shared="+t+"&lang="+thisNoiMapsSettingsLang),jQuery(shadowRoot.querySelectorAll(".outer-map-container")).hasClass("totem")&&void 0!==QRCode&&(roomQRCodeNOIMaps(),thisQrcode.clear(),thisQrcode.makeCode(location.origin+location.pathname+"?shared="+t+"&lang="+thisNoiMapsSettingsLang)),o&&(jQuery(shadowRoot.querySelectorAll(".tooltip .lower .website")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".tooltip .lower .website")).attr("href",o))),jQuery(shadowRoot.querySelectorAll(".tooltip")).fadeIn(),jQuery(shadowRoot.querySelectorAll(".tooltip")).addClass("active"),setTooltipPositionNOIMaps(),tooltipViewportNOIMaps()}}function roomQRCodeNOIMaps(){jQuery(shadowRoot.querySelectorAll(".outer-map-container")).hasClass("totem")&&void 0!==QRCode&&"axonometric"!==jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building")&&(jQuery(shadowRoot.querySelectorAll("#room-qrcode")).html(""),thisQrcode=new QRCode(jQuery(shadowRoot.querySelectorAll("#room-qrcode"))[0],{text:location.origin+location.pathname,width:100,height:100,colorDark:"#000000",colorLight:"#ffffff"}))}function setTooltipPositionNOIMaps(){if(0<jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).length){let t=jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']"))[0];if("axonometric"!==jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building")&&(t=jQuery(shadowRoot.querySelector("[id='"+clickedElementID+"']")).children()[0]),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).hasClass("dim_40")){let e=jQuery(t).offset().left+t.getBoundingClientRect().width/2-jQuery(shadowRoot.querySelectorAll(".inner-map-component")).position().left,o=jQuery(t).offset().top-jQuery(shadowRoot.querySelectorAll(".inner-map-component"))[0].offsetTop+t.getBoundingClientRect().height/2-8;"A1-1-07-A"==clickedElementID&&(e+=60,o+=30),"A2-4-06-A"==clickedElementID&&(o+=20),"A2--1-10-D"==clickedElementID&&(e+=60,o+=30),"A2--1-10-B"==clickedElementID&&(e+=60,o+=30),"A4--1-34"==clickedElementID&&(e+=160,o+=90),"A2--1-22"==clickedElementID&&(e+=20),"A2--1-10-3"==clickedElementID&&(e+=20,o+=20),jQuery(shadowRoot.querySelectorAll(".tooltip")).css({left:e,top:o})}else jQuery(shadowRoot.querySelectorAll(".tooltip")).css({left:0,top:0}),jQuery(shadowRoot.querySelectorAll(".tooltip .pin")).css({left:jQuery(t).offset().left+t.getBoundingClientRect().width/2-15-jQuery(shadowRoot.querySelectorAll(".inner-map-component")).position().left,top:jQuery(t).offset().top-jQuery(shadowRoot.querySelectorAll(".inner-map-component"))[0].offsetTop+t.getBoundingClientRect().height/2-45})}}function tooltipViewportNOIMaps(){jQuery(shadowRoot.querySelectorAll(".tooltip .card")).removeClass("overflow-right"),jQuery(shadowRoot.querySelectorAll(".tooltip .card")).removeClass("overflow-bottom"),jQuery(shadowRoot.querySelectorAll(".tooltip")).hasClass("active")&&(jQuery(shadowRoot.querySelectorAll(".tooltip")).position().left+jQuery(shadowRoot.querySelectorAll(".tooltip .card")).outerWidth()>jQuery(shadowRoot.querySelectorAll(".inner-map-component")).innerWidth()&&jQuery(shadowRoot.querySelectorAll(".tooltip .card")).addClass("overflow-right"),jQuery(shadowRoot.querySelectorAll(".tooltip")).position().top+jQuery(shadowRoot.querySelectorAll(".tooltip .card")).outerHeight()>jQuery(shadowRoot.querySelectorAll(".inner-map-component")).innerHeight()-75&&jQuery(shadowRoot.querySelectorAll(".tooltip .card")).addClass("overflow-bottom"))}function closeTooltipNOIMaps(e){void 0!==e&&""!=e&&null!=e?jQuery(shadowRoot.querySelectorAll(".tooltip")).hasClass("active")&&0==jQuery(e.target).parents(".clickable").length&&!jQuery(e.target).hasClass("tooltip")&&0==jQuery(e.target).parents(".tooltip").length&&jQuery(shadowRoot.querySelectorAll(".tooltip")).fadeOut(200,function(){jQuery(shadowRoot.querySelectorAll(".tooltip")).removeClass("active").html(originalTooltip)}):(jQuery(shadowRoot.querySelectorAll(".tooltip")).fadeOut(200,function(){jQuery(shadowRoot.querySelectorAll(".tooltip")).removeClass("active").html(originalTooltip)}),jQuery(shadowRoot.querySelectorAll('*[id^="building"]')).removeClass("active"))}function drawRoomsCategoryIconsNOIMaps(){void 0!==selettoriType&&null!=selettoriType&&""!=selettoriType&&"axonometric"!=jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building")&&jQuery(shadowRoot.querySelectorAll("#map .clickable")).each(function(){let o=jQuery(this);var t=o.attr("id");if(void 0===o.data("building-code")){if(void 0!==NOIrooms[t]&&null!=NOIrooms[t]&&void 0!==NOIrooms[t].type&&null!=NOIrooms[t].type&&void 0!==selettoriType[NOIrooms[t].type]&&null!==selettoriType[NOIrooms[t].type]&&void 0!==selettoriType[NOIrooms[t].type].image&&null!==selettoriType[NOIrooms[t].type].image){var e=selettoriType[NOIrooms[t].type].image,r=o[0].getBBox(),a=100<r.width/2?100:r.width/2,i=100<r.height/2?100:r.height/2,l=document.createElementNS("http://www.w3.org/2000/svg","image");l.setAttributeNS("http://www.w3.org/1999/xlink","href",e),l.setAttributeNS(null,"width",a),l.setAttributeNS(null,"height",i),l.setAttributeNS(null,"x",r.x+r.width/2-a/2),l.setAttributeNS(null,"y",r.y+r.height/2-i/2),"A2-5-07"==t&&(l.setAttributeNS(null,"y",r.y+r.height/2-i/2+50),l.setAttributeNS(null,"x",r.x+r.width/2-a/2-20)),"A2--1-10-D"==t&&l.setAttributeNS(null,"x",r.x+r.width/2-a/2+80),"A2--1-10-B"==t&&(l.setAttributeNS(null,"y",r.y+r.height/2-i/2+80),l.setAttributeNS(null,"x",r.x+r.width/2-a/2+80)),"D1-2W-16"!=t&&"D1-3W-14"!=t||(l.setAttributeNS(null,"width",.8*a),l.setAttributeNS(null,"height",.8*i),l.setAttributeNS(null,"y",r.y+r.height/2-i/2+50),l.setAttributeNS(null,"x",r.x+r.width/2-a/2+30)),"D1-4W-20"==t&&(l.setAttributeNS(null,"y",r.y+r.height/2-i/2+40),l.setAttributeNS(null,"x",r.x+r.width/2-a/2+40)),"A2--1-10-4"==t&&(l.setAttributeNS(null,"width",.6*a),l.setAttributeNS(null,"height",.6*i),l.setAttributeNS(null,"x",r.x+r.width/2-a/2+40)),"A2--1-10-3"==t&&(l.setAttributeNS(null,"y",r.y+r.height/2-i/2+80),l.setAttributeNS(null,"x",r.x+r.width/2-a/2+80)),"A2--1-10-2"==t&&l.setAttributeNS(null,"x",r.x+r.width/2-a/2-60),o[0].appendChild(l),o.attr("data-category",NOIrooms[t].type),0<jQuery(shadowRoot.querySelectorAll(".filter-container .single-filter input[data-category='"+NOIrooms[t].type+"']")).length&&(jQuery(shadowRoot.querySelectorAll(".filter-container .single-filter input[data-category='"+NOIrooms[t].type+"']")).is(":checked")||o.find("image").hide())}else{let e="A000000";debugActive?(e=t,printElementOnMapNOIMaps(o,t,jQuery('<svg class="label-room" id="map_floorplan_label" data-name="map floorplan label" xmlns="http://www.w3.org/2000/svg" width="230" height="69.7" viewBox="0 0 230 69.7"> <rect id="Rectangle" width="230" height="69.7" rx="17.4" fill="#fff"/> <text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-size="30" fill="#000" font-family="Arial">'+e+"</text></svg>"))):(e=void 0!==NOIrooms[t]&&null!=NOIrooms[t]&&void 0!==NOIrooms[t].beacon_id?NOIrooms[t].beacon_id:t,void 0!==NOIrooms[t]&&null!=NOIrooms[t]&&void 0!==NOIrooms[t].beacon_id&&void 0!==NOIrooms[t].show_on_map&&1==NOIrooms[t].show_on_map?void 0!==NOIrooms[t].floor_description||printElementOnMapNOIMaps(o,t,jQuery('<svg class="label-room" id="map_floorplan_label" data-name="map floorplan label" xmlns="http://www.w3.org/2000/svg" width="230" height="69.7" viewBox="0 0 230 69.7"> <rect id="Rectangle" width="230" height="69.7" rx="17.4" fill="#fff"/> <text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-size="30" fill="#000" font-family="Arial">'+e+"</text></svg>")):jQuery(o).removeClass("clickable"))}void 0===o.data("name")&&o.attr("data-name","customclass "+o.attr("id"))}})}function printElementOnMapNOIMaps(e,o,t){shadowRoot.querySelectorAll("#map svg").innerHTML+="";let r=0,a=0,i=t.attr("width"),l=t.attr("height");void 0!==i&&null!=i&&""!=i||(i="30"),void 0!==l&&null!=l&&""!=l||(l="30");let s=jQuery(shadowRoot.querySelector("[id='"+o+"']"))[0];r=i>.6*s.getBBox().width?(t.attr("width",.6*s.getBBox().width),s.getBBox().x+s.getBBox().width/2-t.attr("width")/2):s.getBBox().x+s.getBBox().width/2-i/2,a=l>.6*s.getBBox().height?(t.attr("height",.6*s.getBBox().height),s.getBBox().y+s.getBBox().height/2-t.attr("height")/2):s.getBBox().y+s.getBBox().height/2-l/2,"A1-0-08"==o&&(r+=120,a+=100,t.attr("width",.7*t.attr("width")),t.attr("height",.7*t.attr("height"))),"A1-0-03"==o&&(a-=40),"A1-1-07-A"==o&&(r+=160),"A2--1-03"==o&&(r-=50,a+=50,t.attr("width",.7*t.attr("width")),t.attr("height",.7*t.attr("height"))),"A2-4-03-G"==o&&(t.attr("width",.7*t.attr("width")),t.attr("height",.7*t.attr("height")),r+=30,a+=15),"A2-4-03-H"==o&&(t.attr("width",.7*t.attr("width")),t.attr("height",.7*t.attr("height")),r+=35,a+=15),"A2-4-06-A"==o&&(a+=90),"A4--1-34"==o&&(r+=500,a+=400),"D1-1W-05"==o&&(r+=100,a+=350),"P1--1-01"==o&&(r+=230,a+=400),"P1--2-28"==o&&(a+=250),"A2--1-22"==o&&(r+=80,a-=50),t.attr("x",r),t.attr("y",a),e.append(t)}function goToBuildingFloorNOIMaps(e,o,t=!0){null!=e&&""!==e&&null!=o&&""!==o&&null!=maps_svgs&&""!==maps_svgs&&(void 0===maps_svgs[e]||void 0!==maps_svgs[e].floors[o]&&null!==maps_svgs[e].floors[o]&&""!==maps_svgs[e].floors[o]||(o=-1),void 0!==maps_svgs[e]&&null!==maps_svgs[e]&&""!==maps_svgs[e]&&void 0!==maps_svgs[e].floors[o]&&null!==maps_svgs[e].floors[o]&&""!==maps_svgs[e].floors[o]?(t&&closeTooltipNOIMaps(),jQuery(shadowRoot.querySelectorAll("#map")).html(maps_svgs[e].floors[o]),jQuery(shadowRoot.querySelectorAll("#map svg g")).each(function(){var e=jQuery(this).get(0).id;null!=e&&""!==e&&void 0!==NOIrooms[e]&&null!==NOIrooms[e]&&void 0!==NOIrooms[e].beacon_id&&jQuery(this).addClass("clickable")}),clickableBehaviourNOIMaps(),floorsZoomSelectorNOIMaps(e,o),navBarsNOIMaps(e,o),drawRoomsCategoryIconsNOIMaps(),translateElementsNOIMaps(),debugPrintIDs()):closeTooltipNOIMaps())}function floorsZoomSelectorNOIMaps(e,o){if(null!=e&&""!==e&&null!=o&&""!==o){var t=jQuery(shadowRoot.querySelectorAll(".floors-zoom-selector"));if("axonometric"!=e){for(var r in t.find(".floors-selector").removeClass("hide"),t.find(".icon-building").addClass("icon-building-"+e),t.find(".icon-building").text(e),maps_svgs)if("axonometric"!=r&&r==e&&void 0!==maps_svgs[r].floors){var a,i=t.find(".floors-list");for(a in i.empty(),maps_svgs[r].floors){var l=jQuery("<li/>",{text:a,class:"floor","data-building-code":e,"data-floor-code":a});a==o&&l.addClass("active"),i.append(l)}}t.find(".floors-list li").sort((e,o)=>jQuery(o).data("floor-code")-jQuery(e).data("floor-code")).appendTo(t.find(".floors-list")),clickableBehaviourNOIMaps()}else t.find(".icon-building").removeClass().addClass("icon-building").empty(),t.find(".floors-list").empty(),t.find(".floors-selector").addClass("hide")}}function navBarsNOIMaps(e,o){if(null!=e&&""!==e&&null!=o&&""!==o)if(jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-building",e),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-floor",o),"axonometric"!=e){for(var t in jQuery(shadowRoot.querySelectorAll(".inner-map-component")).removeClass("axonometric"),jQuery(shadowRoot.querySelectorAll(".main-site-title")).addClass("hide"),jQuery(shadowRoot.querySelectorAll(".navbar-container, .navbar-container *")).removeClass("hide"),jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-trigger, .filters-dropdown.building-select .dropdown-trigger")).text(e),jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-list, .filters-dropdown.building-select .dropdown-list")).empty(),maps_svgs)"axonometric"!=t&&t!=e&&jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-list, .filters-dropdown.building-select .dropdown-list")).append('<li><a href="#" class="building-select-trigger" data-building-code="'+t+'">'+t+"</a></li>");jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-list, .filters-dropdown.building-select .dropdown-list")).removeClass("open"),jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-list, .filters-dropdown.building-select .dropdown-list")).slideUp(150),jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-list, .filters-dropdown.building-select .dropdown-list")).find("li").sort((e,o)=>jQuery(e).text().toUpperCase().localeCompare(jQuery(o).text().toUpperCase())).appendTo(jQuery(shadowRoot.querySelectorAll(".navbar-container .dropdown-list, .filters-dropdown.building-select .dropdown-list"))),clickableBehaviourNOIMaps()}else jQuery(shadowRoot.querySelectorAll(".inner-map-component")).addClass("axonometric"),jQuery(shadowRoot.querySelectorAll(".navbar-container, .navbar-container .site-title")).addClass("hide")}function dropdownToggleNOIMaps(){jQuery(shadowRoot.querySelectorAll(".dropdown-trigger")).unbind("click"),jQuery(shadowRoot.querySelectorAll(".dropdown-trigger")).click(function(){var e=jQuery(this);e.parents(".category-group").toggleClass("open"),e.parent().find(".dropdown-list").slideToggle(300)})}function dropdownSelectionNOIMaps(){jQuery(shadowRoot.querySelectorAll(".dropdown")).find(".dropdown-list a:not(.clickable)").click(function(){var e=jQuery(this),o=e.text(),t=e.parents(".dropdown").find(".dropdown-trigger"),r=t.text();t.text(o),e.text(r)})}function sharerBehavioursNOIMaps(){jQuery(shadowRoot.getElementById("copy-sharer-url")).click(function(){shadowRoot.getElementById("sharer-url-input").select(),document.execCommand("copy");var e=jQuery(shadowRoot.getElementById("copy-sharer-url")).text(),o=getTranslationNOIMaps("Copiato!");jQuery(shadowRoot.getElementById("copy-sharer-url")).text(o),setTimeout(function(){jQuery(shadowRoot.getElementById("copy-sharer-url")).text(e)},1e3)}),jQuery(shadowRoot.querySelectorAll(".sharer-container")).click(function(e){void 0!==e&&void 0!==e.target&&!jQuery(e.target).hasClass("sharer")&&0<!jQuery(e.target).parents(".sharer").length&&jQuery(shadowRoot.querySelectorAll(".sharer-container")).fadeOut(function(){jQuery(shadowRoot.querySelectorAll(".sharer-container")).addClass("hide")})})}function getTranslationNOIMaps(e){if(void 0===translations||null==translations)return getTranslationsNOIMaps(),void getTranslationNOIMaps(e);for(var o in translations)if(o==e)return translations[o][thisNoiMapsSettingsLang];return e}function delayNOIMaps(t,r){var a=0;return function(){var e=this,o=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(e,o)},r||0)}}function searchElementsStarterNOIMaps(){jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container p")).text(getTranslationNOIMaps("Nessun risultato")),jQuery(shadowRoot.querySelectorAll(".search-container .search")).unbind("keyup"),jQuery(shadowRoot.querySelectorAll(".search-container .search")).keyup(delayNOIMaps(function(){var e=jQuery(this).val();jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container")).hide(),searchElementsNOIMaps(e)},250))}function searchElementsNOIMaps(o){jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container")).hide(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.misc .group-rooms-list")).empty();var e,t=[];if(jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group")).hide(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group .group-rooms-list li")).hide(),o.length>=minCharsToSearch){if(null!=NOIrooms)for(var r in NOIrooms){var a,i=!1;for(a in NOIrooms[r])if(void 0!==NOIrooms[r][a])switch(typeof NOIrooms[r][a]){case"string":if("type"==a.toLowerCase())break;-1!=NOIrooms[r][a].toLowerCase().indexOf(o.toString().toLowerCase())&&(i=!0);break;case"object":let e=NOIrooms[r][a];if(void 0!==e[thisNoiMapsSettingsLang]&&null!==e[thisNoiMapsSettingsLang])"string"==typeof e[thisNoiMapsSettingsLang]&&-1!=e[thisNoiMapsSettingsLang].toLowerCase().indexOf(o.toString().toLowerCase())&&(i=!0);else for(var l in e)"string"==typeof e[l]&&-1!=e[l].toLowerCase().indexOf(o.toString().toLowerCase())&&(i=!0)}i&&t.push(NOIrooms[r])}}else jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group:not(.original)")).show(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.misc")).hide(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group:not(.original) .group-rooms-list li")).show(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.open")).find(".group-rooms-list").hide(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.open")).removeClass("open"),jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container")).hide();if(0<t.length)for(var s in t)void 0!==t[s].beacon_id&&null!==t[s].beacon_id&&(e=cleanupRoomLabelNOIMaps(t[s].beacon_id),0<shadowRoot.querySelectorAll('.search-container .category-group-container .category-group:not(.original) .group-rooms-list li[data-room-code="'+e+'"]').length?(jQuery(shadowRoot.querySelectorAll('.search-container .category-group-container .category-group:not(.original) .group-rooms-list li[data-room-code="'+e+'"]')).show(),jQuery(shadowRoot.querySelectorAll('.search-container .category-group-container .category-group:not(.original) .group-rooms-list li[data-room-code="'+e+'"]')).closest(".category-group").show()):createSidebarSingleElementWithoutGroup(t[s]));else jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container")).show();let n=0;jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group:not(.original)")).each(function(){jQuery(this).is(":visible")&&n++}),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.open")).find(".group-rooms-list").hide(),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.open")).removeClass("open"),0==n?jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container")).show():(jQuery(shadowRoot.querySelectorAll(".search-container .no-results-container")).hide(),0<t.length&&(jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group:not(.original)")).each(function(){jQuery(this).is(":visible")&&!jQuery(this).hasClass("open")&&jQuery(this).find(".dropdown-trigger").click()}),sidebarHeightNOIMaps(),clickableBehaviourNOIMaps()))}function sidebarHeightNOIMaps(){var e=jQuery(shadowRoot.querySelectorAll(".inner-map-component")).outerHeight();jQuery(shadowRoot.querySelectorAll(".search-container")).css("height",e),jQuery(shadowRoot.querySelectorAll(".option-filter-container")).css("height",e),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container")).css("height",e-jQuery(shadowRoot.querySelectorAll(".search-container .input-container")).outerHeight()-110)}function createSidebarSingleElementWithoutGroup(t){if(void 0===t.sheetName||"Floors"!=t.sheetName){let o=jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container .category-group.misc"));if(0==o.length){let e=jQuery(shadowRoot.querySelectorAll(".search-container .category-group.original")).clone();e.removeClass("original"),o=e.clone().removeAttr("style").addClass("misc")}o.find("h2").text("Various");let e=cleanupRoomLabelNOIMaps(t.beacon_id);var r,a=e.split("-"),i=t.beacon_id.replace(/\-/g,"~-");i=(i=(i=(i=i.replace(/\s/g,"~")).replace(/\./g,"~")).replace(/~~/g,"~")).split("~");for(var l=0;l<i.length;l++)r=3<i.length?i[i.length-2]+"-"+i[i.length-1]:i[i.length-1];var s=void 0!==t.name&&void 0!==t.name[thisNoiMapsSettingsLang]?t.name[thisNoiMapsSettingsLang]:"";o.find(".group-rooms-list").append('<li class="clickable" data-building-code="'+a[0]+'" data-room-code="'+e+'" data-floor-code="'+t.floor+'"><span class="room-icon-building icon-building-'+a[0]+'">'+a[0]+'</span><span class="room-name">'+s+'</span><span class="room-floor">'+t.floor+'</span><span class="room-number">'+r+"</span></li>"),o.css("display","block"),o.find(".group-rooms-list").css("display","block"),jQuery(shadowRoot.querySelectorAll(".search-container .category-group-container")).append(o)}}function setMediaQueriesNOIMaps(){var e=jQuery(shadowRoot.querySelectorAll(".inner-map-component")).outerWidth(),o=jQuery(shadowRoot.querySelectorAll(".inner-map-component")).outerHeight();jQuery(shadowRoot.querySelectorAll(".inner-map-component")).removeClass(["dim_5","dim_10","dim_20","dim_30","dim_40","dim_50","dim_70","h_min_750","h_min_850"]),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).removeAttr("data-height"),jQuery(shadowRoot.querySelectorAll(".inner-map-component")).attr("data-height",Math.round(o/10));let t="";switch(!0){case e<=400:t="dim_5";break;case 400<e&&e<=450:t="dim_5 dim_10";break;case 450<e&&e<=500:t="dim_5 dim_10 dim_20";break;case 500<e&&e<=600:t="dim_5 dim_10 dim_20 dim_30";break;case 600<e&&e<=700:t="dim_5 dim_10 dim_20 dim_30 dim_40";break;case 700<e&&e<=800:t="dim_5 dim_10 dim_20 dim_30 dim_40 dim_50";break;case 800<e:t="dim_5 dim_10 dim_20 dim_30 dim_40 dim_50 dim_70"}""!==t&&jQuery(shadowRoot.querySelectorAll(".inner-map-component")).addClass(t)}function debugPrintIDs(){1==getParams.get("showids")&&jQuery(shadowRoot.querySelectorAll('#map *[data-name~="customclass"]')).each(function(){let e=jQuery(this);var o=e.attr("id"),t=o,t=jQuery('<svg class="label-room debug" id="map_floorplan_label" data-name="map floorplan label" xmlns="http://www.w3.org/2000/svg" width="230" height="69.7" viewBox="0 0 230 69.7"> <rect id="Rectangle" width="230" height="69.7" rx="17.4" fill="#ff7f00"/> <text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-size="35" fill="#000" font-family="Arial" font-weight="bold">'+t+"</text></svg>");shadowRoot.querySelectorAll("#map svg").innerHTML+="";let r=0,a=0,i=t.attr("width"),l=t.attr("height");void 0!==i&&null!=i&&""!=i||(i="30"),void 0!==l&&null!=l&&""!=l||(l="30");let s=jQuery(shadowRoot.querySelector("[id='"+o+"']"))[0];r=i>.6*s.getBBox().width?(t.attr("width",.6*s.getBBox().width),s.getBBox().x+s.getBBox().width/2-t.attr("width")/2):s.getBBox().x+s.getBBox().width/2-i/2,a=l>.6*s.getBBox().height?(t.attr("height",.6*s.getBBox().height),s.getBBox().y+s.getBBox().height/2-t.attr("height")/2):s.getBBox().y+s.getBBox().height/2-l/2,t.attr("x",r),t.attr("y",a),e.append(t)})}customElements.define("map-view",MapView);